import{an as Q,r as $,a as W,b2 as U,g as J,aj as k,W as B,aa as K,j as X,p as L,d as Y,o as P,V as G,D as R,b3 as z,ag as ee,J as te}from"./index-BgBVt1_Q.js";import{a as ie,u as ne}from"./homeassistant-PiMeOH9o.js";let ae=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const n=document.createElement("div");Object.assign(n.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(n),e.scrollLeft=-1e3,ae=e.scrollLeft>=0,e.remove()}const j=ie(),le=new RegExp("tasmota/discovery/.*/config"),S={CMND:0,STAT:1,TELE:2},ve=Q("tasmota",()=>{const e=ne(),n=$({}),a=$([]),t=$(null),s=$({SetOption83:null,SetOption89:null,SetOption112:null,SensorRetain:null});e.subscribe(le,(i,l)=>{const d=JSON.parse(l);n.value[d.mac]=d,b(d)&&h(d)});let f,u=0;function g(i,l,d){const v=JSON.parse(d);if(v.ZbStatus1)a.value=v.ZbStatus1,u=0,a.value.forEach(o=>e.publish(_(i,S.CMND)+"ZbStatus3",o.Device));else if(v.ZbStatus3){const o=a.value.findIndex(E=>E.Device===v.ZbStatus3[0].Device),p=v.ZbStatus3[0];if(p.Name)a.value[o]=p;else{const{Device:E,...Z}=p,F={Device:E,Name:"",...Z};a.value[o]=F}u++,u===a.value.length&&f&&e.unsubscribe(f)}else{const o=Object.keys(v).pop();["SetOption83","SetOption89","SetOption112","SensorRetain"].includes(o)?s.value[o]=v[o]==="ON":console.log("Unknown message",v)}}function h(i){a.value=[],t.value=i,f=e.subscribe(_(i,S.STAT)+"RESULT",(l,d)=>g(i,l,d)),["ZbStatus1","SetOption83","SetOption89","SetOption112","SensorRetain"].forEach(l=>{e.publish(_(i,S.CMND)+l,"")})}function m(i,l){const d=t.value;d&&(typeof l=="boolean"&&(l=Number(l)),e.publish(_(d,S.CMND)+i,`${l}`),h(d))}function b(i){return i.md==="Sonoff ZbBridge"||i.md==="Sonoff Zigbee Pro"}function _(i,l=S.TELE){return i.ft.replace("%topic%",i.t).replace("%prefix%",i.tp[l])}const x=W(()=>Object.values(n.value).filter(i=>b(i)));function r(i){const l=i.IEEEAddr.toLowerCase(),d=i.ModelId==="TH01"?"SNZB-02":i.ModelId||"Unknown";return{id:l,config:{identifiers:[`zigbee2tasmota_${l}`],manufacturer:"SONOFF",model:`Temperature And Humidity Sensor (${d})`,name:i.Name},entities:["temperature","humidity","battery","voltage","linkquality"].map(o=>c(i,o))}}function c(i,l){const d=i.IEEEAddr.toLowerCase(),v={type:"sensor",id:l},o={availability_mode:"all",availability_topic:`${_(t.value,S.TELE)}LWT`,payload_available:"Online",payload_not_available:"Offline",name:`${i.Name} `,state_topic:`${_(t.value,S.TELE)}${s.value.SetOption83?i.Name:i.Device}/SENSOR`,unique_id:`${d}_${l}_zigbee2tasmota`,state_class:"measurement"};let p;return l==="temperature"&&(p="Temperature",o.device_class="temperature",o.enabled_by_default=!0,o.unit_of_measurement="Â°C",o.name+=l),l==="humidity"&&(p="Humidity",o.device_class="humidity",o.enabled_by_default=!0,o.unit_of_measurement="%",o.name+=l),l==="battery"&&(p="BatteryPercentage",o.device_class="battery",o.enabled_by_default=!0,o.unit_of_measurement="%",o.entity_category="diagnostic",o.name+=l),l==="voltage"&&(p="BatteryVoltage",o.device_class="voltage",o.enabled_by_default=!1,o.unit_of_measurement="V",o.entity_category="diagnostic",o.name+=l),l==="linkquality"&&(p="LinkQuality",o.device_class="linkquality",o.enabled_by_default=!1,o.unit_of_measurement="lqi",o.icon="mdi:signal",o.entity_category="diagnostic",o.name+=l),o.value_template=`{% if value_json.ZbReceived.${s.value.SetOption112?i.Name:i.Device}.${p} is defined %}
  {{ value_json.ZbReceived.${s.value.SetOption112?i.Name:i.Device}.${p} }}
{% else %}
  {{ states(entity_id) }}
{% endif %}
`,v.config=o,v}function H(){a.value.filter(i=>["TH01","SNZB-02P","SNZB-02D"].includes(i.ModelId)).forEach(i=>{j.addDevice(r(i))}),this.router.push("/discovery-generator")}function w(i){const l=i.IEEEAddr.toLowerCase(),d=i.ModelId||"TRVZB",v=s.value.SetOption112?i.Name:i.Device,o=s.value.SetOption83?i.Name:i.Device;return{id:l,config:{identifiers:[`zigbee2tasmota_${l}`],manufacturer:"SONOFF",model:`Zigbee Thermostatic Radiator Valve (${d})`,name:i.Name},entities:[D(i,v,o),A(i,"linkquality",v,o)]}}function D(i,l,d){const v=i.IEEEAddr.toLowerCase(),o=`${_(t.value,S.TELE)}${d}/SENSOR`;return{type:"climate",id:"climate",config:{availability_mode:"all",availability_topic:`${_(t.value,S.TELE)}LWT`,payload_available:"Online",payload_not_available:"Offline",name:i.Name,unique_id:`${v}_climate_zigbee2tasmota`,modes:["off","heat"],current_temperature_topic:o,current_temperature_template:`{% if value_json.ZbReceived.${l}.LocalTemperature is defined %}
  {{ value_json.ZbReceived.${l}.LocalTemperature }}
{% else %}
  {{ states.climate.${i.Name.replace(/[^a-zA-Z0-9_]/g,"_")}.attributes.current_temperature | default(0) }}
{% endif %}`,temperature_state_topic:o,temperature_state_template:`{% if value_json.ZbReceived.${l}.OccupiedHeatingSetpoint is defined %}
  {{ value_json.ZbReceived.${l}.OccupiedHeatingSetpoint }}
{% else %}
  {{ states.climate.${i.Name.replace(/[^a-zA-Z0-9_]/g,"_")}.attributes.temperature | default(20) }}
{% endif %}`,temperature_command_topic:`${_(t.value,S.CMND)}ZbSend`,temperature_command_template:`{"Device":"${i.Device}","Write":{"OccupiedHeatingSetpoint":{{ value }}}}`,mode_state_topic:o,mode_state_template:`{% if value_json.ZbReceived.${l}.Power is defined %}
  {{ 'heat' if value_json.ZbReceived.${l}.Power == 1 else 'off' }}
{% else %}
  {{ states('climate.${i.Name.replace(/[^a-zA-Z0-9_]/g,"_")}') | default('off') }}
{% endif %}`,mode_command_topic:`${_(t.value,S.CMND)}ZbSend`,mode_command_template:`{"Device":"${i.Device}","Write":{"Power":{{ '1' if value == 'heat' else '0' }}}}`,min_temp:4,max_temp:35,temp_step:.5,temperature_unit:"C"}}}function A(i,l,d,v){const o=i.IEEEAddr.toLowerCase(),p={type:"sensor",id:l},E={availability_mode:"all",availability_topic:`${_(t.value,S.TELE)}LWT`,payload_available:"Online",payload_not_available:"Offline",name:`${i.Name} `,state_topic:`${_(t.value,S.TELE)}${v}/SENSOR`,unique_id:`${o}_${l}_zigbee2tasmota`,state_class:"measurement"};let Z;return Z="LinkQuality",E.enabled_by_default=!1,E.unit_of_measurement="lqi",E.icon="mdi:signal",E.entity_category="diagnostic",E.name+="linkquality",E.value_template=`{% if value_json.ZbReceived.${d}.${Z} is defined %}
  {{ value_json.ZbReceived.${d}.${Z} }}
{% else %}
  {{ states(entity_id) }}
{% endif %}
`,p.config=E,p}function y(){a.value.filter(i=>i.ModelId==="TRVZB").forEach(i=>{j.addDevice(w(i))}),this.router.push("/discovery-generator")}return{config:s,ZbInfos:a,devices:n,devicesCount:W(()=>Object.keys(n.value).length),zbBridges:x,selectedZBDevice:t,getZbInfo:h,publishCmd:m,isZBBridge:b,resolveFullTopic:_,generateHomeAssistantDiscoveryForAllSNZB02:H,generateHomeAssistantDiscoveryForAllTRVZB:y}});function oe(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),U.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const se={target:{type:[Boolean,String,Element],default:!0},noParentEvent:Boolean},he={...se,contextMenu:Boolean};function pe({showing:e,avoidEmit:n,configureAnchorEl:a}){const{props:t,proxy:s,emit:f}=J(),u=$(null);let g=null;function h(r){return u.value===null?!1:r===void 0||r.touches===void 0||r.touches.length<=1}const m={};a===void 0&&(Object.assign(m,{hide(r){s.hide(r)},toggle(r){s.toggle(r),r.qAnchorHandled=!0},toggleKey(r){X(r,13)===!0&&m.toggle(r)},contextClick(r){s.hide(r),k(r),K(()=>{s.show(r),r.qAnchorHandled=!0})},prevent:k,mobileTouch(r){if(m.mobileCleanup(r),h(r)!==!0)return;s.hide(r),u.value.classList.add("non-selectable");const c=r.target;B(m,"anchor",[[c,"touchmove","mobileCleanup","passive"],[c,"touchend","mobileCleanup","passive"],[c,"touchcancel","mobileCleanup","passive"],[u.value,"contextmenu","prevent","notPassive"]]),g=setTimeout(()=>{g=null,s.show(r),r.qAnchorHandled=!0},300)},mobileCleanup(r){u.value.classList.remove("non-selectable"),g!==null&&(clearTimeout(g),g=null),e.value===!0&&r!==void 0&&oe()}}),a=function(r=t.contextMenu){if(t.noParentEvent===!0||u.value===null)return;let c;r===!0?s.$q.platform.is.mobile===!0?c=[[u.value,"touchstart","mobileTouch","passive"]]:c=[[u.value,"mousedown","hide","passive"],[u.value,"contextmenu","contextClick","notPassive"]]:c=[[u.value,"click","toggle","passive"],[u.value,"keyup","toggleKey","passive"]],B(m,"anchor",c)});function b(){G(m,"anchor")}function _(r){for(u.value=r;u.value.classList.contains("q-anchor--skip");)u.value=u.value.parentNode;a()}function x(){if(t.target===!1||t.target===""||s.$el.parentNode===null)u.value=null;else if(t.target===!0)_(s.$el.parentNode);else{let r=t.target;if(typeof t.target=="string")try{r=document.querySelector(t.target)}catch{r=void 0}r!=null?(u.value=r.$el||r,a()):(u.value=null,console.error(`Anchor: target "${t.target}" not found`))}}return L(()=>t.contextMenu,r=>{u.value!==null&&(b(),a(r))}),L(()=>t.target,()=>{u.value!==null&&b(),x()}),L(()=>t.noParentEvent,r=>{u.value!==null&&(r===!0?b():a())}),Y(()=>{x(),n!==!0&&t.modelValue===!0&&u.value===null&&f("update:modelValue",!1)}),P(()=>{g!==null&&clearTimeout(g),b()}),{anchorEl:u,canShow:h,anchorEvents:m}}function ge(e,n){const a=$(null);let t;function s(g,h){const m=`${h!==void 0?"add":"remove"}EventListener`,b=h!==void 0?h:t;g!==window&&g[m]("scroll",b,R.passive),window[m]("scroll",b,R.passive),t=h}function f(){a.value!==null&&(s(a.value),a.value=null)}const u=L(()=>e.noParentEvent,()=>{a.value!==null&&(f(),n())});return P(u),{localScrollTarget:a,unconfigureScrollTarget:f,changeScrollEvent:s}}const{notPassiveCapture:N}=R,T=[];function C(e){const n=e.target;if(n===void 0||n.nodeType===8||n.classList.contains("no-pointer-events")===!0)return;let a=z.length-1;for(;a>=0;){const t=z[a].$;if(t.type.name==="QTooltip"){a--;continue}if(t.type.name!=="QDialog")break;if(t.props.seamless!==!0)return;a--}for(let t=T.length-1;t>=0;t--){const s=T[t];if((s.anchorEl.value===null||s.anchorEl.value.contains(n)===!1)&&(n===document.body||s.innerRef.value!==null&&s.innerRef.value.contains(n)===!1))e.qClickOutside=!0,s.onClickOutside(e);else return}}function be(e){T.push(e),T.length===1&&(document.addEventListener("mousedown",C,N),document.addEventListener("touchstart",C,N))}function _e(e){const n=T.findIndex(a=>a===e);n!==-1&&(T.splice(n,1),T.length===0&&(document.removeEventListener("mousedown",C,N),document.removeEventListener("touchstart",C,N)))}let q,V;function ye(e){const n=e.split(" ");return n.length!==2?!1:["top","center","bottom"].includes(n[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(n[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function Se(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const M={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{M[`${e}#ltr`]=e,M[`${e}#rtl`]=e});function Ee(e,n){const a=e.split(" ");return{vertical:a[0],horizontal:M[`${a[1]}#${n===!0?"rtl":"ltr"}`]}}function re(e,n){let{top:a,left:t,right:s,bottom:f,width:u,height:g}=e.getBoundingClientRect();return n!==void 0&&(a-=n[1],t-=n[0],f+=n[1],s+=n[0],u+=n[0],g+=n[1]),{top:a,bottom:f,height:g,left:t,right:s,width:u,middle:t+(s-t)/2,center:a+(f-a)/2}}function ue(e,n,a){let{top:t,left:s}=e.getBoundingClientRect();return t+=n.top,s+=n.left,a!==void 0&&(t+=a[1],s+=a[0]),{top:t,bottom:t+1,height:1,left:s,right:s+1,width:1,middle:s,center:t}}function ce(e,n){return{top:0,center:n/2,bottom:n,left:0,middle:e/2,right:e}}function I(e,n,a,t){return{top:e[a.vertical]-n[t.vertical],left:e[a.horizontal]-n[t.horizontal]}}function de(e,n=0){if(e.targetEl===null||e.anchorEl===null||n>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{de(e,n+1)},10);return}const{targetEl:a,offset:t,anchorEl:s,anchorOrigin:f,selfOrigin:u,absoluteOffset:g,fit:h,cover:m,maxHeight:b,maxWidth:_}=e;if(ee.is.ios===!0&&window.visualViewport!==void 0){const d=document.body.style,{offsetLeft:v,offsetTop:o}=window.visualViewport;v!==q&&(d.setProperty("--q-pe-left",v+"px"),q=v),o!==V&&(d.setProperty("--q-pe-top",o+"px"),V=o)}const{scrollLeft:x,scrollTop:r}=a,c=g===void 0?re(s,m===!0?[0,0]:t):ue(s,g,t);Object.assign(a.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:_,maxHeight:b,visibility:"visible"});const{offsetWidth:H,offsetHeight:w}=a,{elWidth:D,elHeight:A}=h===!0||m===!0?{elWidth:Math.max(c.width,H),elHeight:m===!0?Math.max(c.height,w):w}:{elWidth:H,elHeight:w};let y={maxWidth:_,maxHeight:b};(h===!0||m===!0)&&(y.minWidth=c.width+"px",m===!0&&(y.minHeight=c.height+"px")),Object.assign(a.style,y);const i=ce(D,A);let l=I(c,i,f,u);if(g===void 0||t===void 0)O(l,c,i,f,u);else{const{top:d,left:v}=l;O(l,c,i,f,u);let o=!1;if(l.top!==d){o=!0;const p=2*t[1];c.center=c.top-=p,c.bottom-=p+2}if(l.left!==v){o=!0;const p=2*t[0];c.middle=c.left-=p,c.right-=p+2}o===!0&&(l=I(c,i,f,u),O(l,c,i,f,u))}y={top:l.top+"px",left:l.left+"px"},l.maxHeight!==void 0&&(y.maxHeight=l.maxHeight+"px",c.height>l.maxHeight&&(y.minHeight=y.maxHeight)),l.maxWidth!==void 0&&(y.maxWidth=l.maxWidth+"px",c.width>l.maxWidth&&(y.minWidth=y.maxWidth)),Object.assign(a.style,y),a.scrollTop!==r&&(a.scrollTop=r),a.scrollLeft!==x&&(a.scrollLeft=x)}function O(e,n,a,t,s){const f=a.bottom,u=a.right,g=te(),h=window.innerHeight-g,m=document.body.clientWidth;if(e.top<0||e.top+f>h)if(s.vertical==="center")e.top=n[t.vertical]>h/2?Math.max(0,h-f):0,e.maxHeight=Math.min(f,h);else if(n[t.vertical]>h/2){const b=Math.min(h,t.vertical==="center"?n.center:t.vertical===s.vertical?n.bottom:n.top);e.maxHeight=Math.min(f,b),e.top=Math.max(0,b-f)}else e.top=Math.max(0,t.vertical==="center"?n.center:t.vertical===s.vertical?n.top:n.bottom),e.maxHeight=Math.min(f,h-e.top);if(e.left<0||e.left+u>m)if(e.maxWidth=Math.min(u,m),s.horizontal==="middle")e.left=n[t.horizontal]>m/2?Math.max(0,m-u):0;else if(n[t.horizontal]>m/2){const b=Math.min(m,t.horizontal==="middle"?n.middle:t.horizontal===s.horizontal?n.right:n.left);e.maxWidth=Math.min(u,b),e.left=Math.max(0,b-e.maxWidth)}else e.left=Math.max(0,t.horizontal==="middle"?n.middle:t.horizontal===s.horizontal?n.left:n.right),e.maxWidth=Math.min(u,m-e.left)}export{ye as a,ge as b,pe as c,be as d,_e as e,oe as f,ve as g,he as h,Ee as p,ae as r,de as s,se as u,Se as v};
