import{a2 as Z,r as _,a as L,a3 as z,a4 as q,e as B,a5 as M,x as I,T as A,l as E,d as j,o as N,j as F,S as P,D as C,a6 as $,a7 as V,H as K}from"./index.b5beb44c.js";import{a as Q,u as U}from"./homeassistant.afc81340.js";let J=!1;{const e=document.createElement("div"),t=document.createElement("div");e.setAttribute("dir","rtl"),e.style.width="1px",e.style.height="1px",e.style.overflow="auto",t.style.width="1000px",t.style.height="1px",document.body.appendChild(e),e.appendChild(t),e.scrollLeft=-1e3,J=e.scrollLeft>=0,e.remove()}const X=Q(),Y=new RegExp("tasmota/discovery/.*/config"),S={CMND:0,STAT:1,TELE:2},oe=Z("tasmota",()=>{const e=U(),t=_({}),a=_([]),i=_(null),n=_({SetOption83:null,SetOption89:null,SetOption112:null,SensorRetain:null});e.subscribe(Y,(s,u)=>{const v=JSON.parse(u);t.value[v.mac]=v,f(v)&&d(v)});let m,l=0;function h(s,u,v){const p=JSON.parse(v);if(p.ZbStatus1)a.value=p.ZbStatus1,l=0,a.value.forEach(r=>e.publish(g(s,S.CMND)+"ZbStatus3",r.Device));else if(p.ZbStatus3){const r=a.value.findIndex(y=>y.Device===p.ZbStatus3[0].Device);a.value[r]=p.ZbStatus3[0],l++,l===a.value.length&&m&&e.unsubscribe(m)}else{const r=Object.keys(p).pop();["SetOption83","SetOption89","SetOption112","SensorRetain"].includes(r)?n.value[r]=p[r]==="ON":console.log("Unknown message",p)}}function d(s){a.value=[],i.value=s,m=e.subscribe(g(s,S.STAT)+"RESULT",(u,v)=>h(s,u,v)),["ZbStatus1","SetOption83","SetOption89","SetOption112","SensorRetain"].forEach(u=>{e.publish(g(s,S.CMND)+u,"")})}function c(s,u){const v=i.value;v&&(typeof u=="boolean"&&(u=Number(u)),e.publish(g(v,S.CMND)+s,`${u}`),d(v))}function f(s){return s.md==="Sonoff ZbBridge"}function g(s,u=S.TELE){return s.ft.replace("%topic%",s.t).replace("%prefix%",s.tp[u])}const T=L(()=>Object.values(t.value).filter(s=>f(s)));function o(s){const u=s.IEEEAddr.toLowerCase();return{id:u,config:{identifiers:[`zigbee2tasmota_${u}`],manufacturer:"SONOFF",model:"Temperature and humidity sensor (SNZB-02)",name:s.Name},entities:["temperature","humidity","battery","voltage","linkquality"].map(p=>b(s,p))}}function b(s,u){const v=s.IEEEAddr.toLowerCase(),p={type:"sensor",id:u},r={availability_mode:"all",availability_topic:`${g(i.value,S.TELE)}LWT`,payload_available:"Online",payload_not_available:"Offline",name:`${s.Name} `,state_topic:`${g(i.value,S.TELE)}${n.value.SetOption83?s.Name:s.Device}/SENSOR`,unique_id:`${v}_${u}_zigbee2tasmota`,state_class:"measurement"};let y;return u==="temperature"&&(y="Temperature",r.device_class="temperature",r.enabled_by_default=!0,r.unit_of_measurement="\xB0C",r.name+=u),u==="humidity"&&(y="Humidity",r.device_class="humidity",r.enabled_by_default=!0,r.unit_of_measurement="%",r.name+=u),u==="battery"&&(y="BatteryPercentage",r.device_class="battery",r.enabled_by_default=!0,r.unit_of_measurement="%",r.entity_category="diagnostic",r.name+=u),u==="voltage"&&(y="BatteryVoltage",r.device_class="voltage",r.enabled_by_default=!1,r.unit_of_measurement="V",r.entity_category="diagnostic",r.name+=u),u==="linkquality"&&(y="LinkQuality",r.device_class="linkquality",r.enabled_by_default=!1,r.unit_of_measurement="lqi",r.icon="mdi:signal",r.entity_category="diagnostic",r.name+=u),r.value_template=`{% if value_json.ZbReceived.${n.value.SetOption112?s.Name:s.Device}.${y} is defined %}
  {{ value_json.ZbReceived.${n.value.SetOption112?s.Name:s.Device}.${y} }}
{% else %}
  {{ states(entity_id) }}
{% endif %}
`,p.config=r,p}function D(){a.value.filter(s=>s.ModelId==="TH01").forEach(s=>{X.addDevice(o(s))}),z.push("/discovery-generator")}return{config:n,ZbInfos:a,devices:t,devicesCount:L(()=>Object.keys(t.value).length),zbBridges:T,selectedZBDevice:i,getZbInfo:d,publishCmd:c,isZBBridge:f,resolveFullTopic:g,generateHomeAssistantDiscoveryForAllTH01:D}});function G(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),q.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const ae={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function se({showing:e,avoidEmit:t,configureAnchorEl:a}){const{props:i,proxy:n,emit:m}=F(),l=_(null);let h;function d(o){return l.value===null?!1:o===void 0||o.touches===void 0||o.touches.length<=1}const c={};a===void 0&&(Object.assign(c,{hide(o){n.hide(o)},toggle(o){n.toggle(o),o.qAnchorHandled=!0},toggleKey(o){B(o,13)===!0&&c.toggle(o)},contextClick(o){n.hide(o),M(o),I(()=>{n.show(o),o.qAnchorHandled=!0})},prevent:M,mobileTouch(o){if(c.mobileCleanup(o),d(o)!==!0)return;n.hide(o),l.value.classList.add("non-selectable");const b=o.target;A(c,"anchor",[[b,"touchmove","mobileCleanup","passive"],[b,"touchend","mobileCleanup","passive"],[b,"touchcancel","mobileCleanup","passive"],[l.value,"contextmenu","prevent","notPassive"]]),h=setTimeout(()=>{n.show(o),o.qAnchorHandled=!0},300)},mobileCleanup(o){l.value.classList.remove("non-selectable"),clearTimeout(h),e.value===!0&&o!==void 0&&G()}}),a=function(o=i.contextMenu){if(i.noParentEvent===!0||l.value===null)return;let b;o===!0?n.$q.platform.is.mobile===!0?b=[[l.value,"touchstart","mobileTouch","passive"]]:b=[[l.value,"mousedown","hide","passive"],[l.value,"contextmenu","contextClick","notPassive"]]:b=[[l.value,"click","toggle","passive"],[l.value,"keyup","toggleKey","passive"]],A(c,"anchor",b)});function f(){P(c,"anchor")}function g(o){for(l.value=o;l.value.classList.contains("q-anchor--skip");)l.value=l.value.parentNode;a()}function T(){if(i.target===!1||i.target===""||n.$el.parentNode===null)l.value=null;else if(i.target===!0)g(n.$el.parentNode);else{let o=i.target;if(typeof i.target=="string")try{o=document.querySelector(i.target)}catch{o=void 0}o!=null?(l.value=o.$el||o,a()):(l.value=null,console.error(`Anchor: target "${i.target}" not found`))}}return E(()=>i.contextMenu,o=>{l.value!==null&&(f(),a(o))}),E(()=>i.target,()=>{l.value!==null&&f(),T()}),E(()=>i.noParentEvent,o=>{l.value!==null&&(o===!0?f():a())}),j(()=>{T(),t!==!0&&i.modelValue===!0&&l.value===null&&m("update:modelValue",!1)}),N(()=>{clearTimeout(h),f()}),{anchorEl:l,canShow:d,anchorEvents:c}}function re(e,t){const a=_(null);let i;function n(h,d){const c=`${d!==void 0?"add":"remove"}EventListener`,f=d!==void 0?d:i;h!==window&&h[c]("scroll",f,C.passive),window[c]("scroll",f,C.passive),i=d}function m(){a.value!==null&&(n(a.value),a.value=null)}const l=E(()=>e.noParentEvent,()=>{a.value!==null&&(m(),t())});return N(l),{localScrollTarget:a,unconfigureScrollTarget:m,changeScrollEvent:n}}let R;const{notPassiveCapture:w}=C,x=[];function H(e){clearTimeout(R);const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let a=$.length-1;for(;a>=0;){const i=$[a].$;if(i.type.name!=="QDialog")break;if(i.props.seamless!==!0)return;a--}for(let i=x.length-1;i>=0;i--){const n=x[i];if((n.anchorEl.value===null||n.anchorEl.value.contains(t)===!1)&&(t===document.body||n.innerRef.value!==null&&n.innerRef.value.contains(t)===!1))e.qClickOutside=!0,n.onClickOutside(e);else return}}function ue(e){x.push(e),x.length===1&&(document.addEventListener("mousedown",H,w),document.addEventListener("touchstart",H,w))}function ce(e){const t=x.findIndex(a=>a===e);t>-1&&(x.splice(t,1),x.length===0&&(clearTimeout(R),document.removeEventListener("mousedown",H,w),document.removeEventListener("touchstart",H,w)))}let k,W;function de(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function me(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const O={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{O[`${e}#ltr`]=e,O[`${e}#rtl`]=e});function fe(e,t){const a=e.split(" ");return{vertical:a[0],horizontal:O[`${a[1]}#${t===!0?"rtl":"ltr"}`]}}function ee(e,t){let{top:a,left:i,right:n,bottom:m,width:l,height:h}=e.getBoundingClientRect();return t!==void 0&&(a-=t[1],i-=t[0],m+=t[1],n+=t[0],l+=t[0],h+=t[1]),{top:a,left:i,right:n,bottom:m,width:l,height:h,middle:i+(n-i)/2,center:a+(m-a)/2}}function te(e){return{top:0,center:e.offsetHeight/2,bottom:e.offsetHeight,left:0,middle:e.offsetWidth/2,right:e.offsetWidth}}function he(e){if(V.is.ios===!0&&window.visualViewport!==void 0){const h=document.body.style,{offsetLeft:d,offsetTop:c}=window.visualViewport;d!==k&&(h.setProperty("--q-pe-left",d+"px"),k=d),c!==W&&(h.setProperty("--q-pe-top",c+"px"),W=c)}let t;const{scrollLeft:a,scrollTop:i}=e.el;if(e.absoluteOffset===void 0)t=ee(e.anchorEl,e.cover===!0?[0,0]:e.offset);else{const{top:h,left:d}=e.anchorEl.getBoundingClientRect(),c=h+e.absoluteOffset.top,f=d+e.absoluteOffset.left;t={top:c,left:f,width:1,height:1,right:f+1,center:c,middle:f,bottom:c+1}}let n={maxHeight:e.maxHeight,maxWidth:e.maxWidth,visibility:"visible"};(e.fit===!0||e.cover===!0)&&(n.minWidth=t.width+"px",e.cover===!0&&(n.minHeight=t.height+"px")),Object.assign(e.el.style,n);const m=te(e.el),l={top:t[e.anchorOrigin.vertical]-m[e.selfOrigin.vertical],left:t[e.anchorOrigin.horizontal]-m[e.selfOrigin.horizontal]};ie(l,t,m,e.anchorOrigin,e.selfOrigin),n={top:l.top+"px",left:l.left+"px"},l.maxHeight!==void 0&&(n.maxHeight=l.maxHeight+"px",t.height>l.maxHeight&&(n.minHeight=n.maxHeight)),l.maxWidth!==void 0&&(n.maxWidth=l.maxWidth+"px",t.width>l.maxWidth&&(n.minWidth=n.maxWidth)),Object.assign(e.el.style,n),e.el.scrollTop!==i&&(e.el.scrollTop=i),e.el.scrollLeft!==a&&(e.el.scrollLeft=a)}function ie(e,t,a,i,n){const m=a.bottom,l=a.right,h=K(),d=window.innerHeight-h,c=document.body.clientWidth;if(e.top<0||e.top+m>d)if(n.vertical==="center")e.top=t[i.vertical]>d/2?Math.max(0,d-m):0,e.maxHeight=Math.min(m,d);else if(t[i.vertical]>d/2){const f=Math.min(d,i.vertical==="center"?t.center:i.vertical===n.vertical?t.bottom:t.top);e.maxHeight=Math.min(m,f),e.top=Math.max(0,f-m)}else e.top=Math.max(0,i.vertical==="center"?t.center:i.vertical===n.vertical?t.top:t.bottom),e.maxHeight=Math.min(m,d-e.top);if(e.left<0||e.left+l>c)if(e.maxWidth=Math.min(l,c),n.horizontal==="middle")e.left=t[i.horizontal]>c/2?Math.max(0,c-l):0;else if(t[i.horizontal]>c/2){const f=Math.min(c,i.horizontal==="middle"?t.middle:i.horizontal===n.horizontal?t.right:t.left);e.maxWidth=Math.min(l,f),e.left=Math.max(0,f-e.maxWidth)}else e.left=Math.max(0,i.horizontal==="middle"?t.middle:i.horizontal===n.horizontal?t.left:t.right),e.maxWidth=Math.min(l,c-e.left)}export{me as a,re as b,se as c,ce as d,G as e,ue as f,oe as g,fe as p,J as r,he as s,ae as u,de as v};
