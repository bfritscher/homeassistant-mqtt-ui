import{an as Q,r as w,a as W,b2 as U,g as J,aj as k,W as B,aa as K,j as X,p as N,d as Y,o as I,V as G,D as R,b3 as z,ag as ee,J as te}from"./index-V6CcqAmY.js";import{a as ie,u as ae}from"./homeassistant-Dy3qvHUR.js";let ne=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const a=document.createElement("div");Object.assign(a.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(a),e.scrollLeft=-1e3,ne=e.scrollLeft>=0,e.remove()}const j=ie(),le=new RegExp("tasmota/discovery/.*/config"),E={CMND:0,STAT:1,TELE:2},ve=Q("tasmota",()=>{const e=ae(),a=w({}),l=w([]),i=w(null),s=w({SetOption83:null,SetOption89:null,SetOption112:null,SensorRetain:null});e.subscribe(le,(t,n)=>{const d=JSON.parse(n);a.value[d.mac]=d,b(d)&&h(d)});let v,u=0;function g(t,n,d){const m=JSON.parse(d);if(m.ZbStatus1)l.value=m.ZbStatus1,u=0,l.value.forEach(o=>e.publish(y(t,E.CMND)+"ZbStatus3",o.Device));else if(m.ZbStatus3){const o=l.value.findIndex(_=>_.Device===m.ZbStatus3[0].Device),p=m.ZbStatus3[0];if(p.Name)l.value[o]=p;else{const{Device:_,...T}=p,F={Device:_,Name:"",...T};l.value[o]=F}u++,u===l.value.length&&v&&e.unsubscribe(v)}else{const o=Object.keys(m).pop();["SetOption83","SetOption89","SetOption112","SensorRetain"].includes(o)?s.value[o]=m[o]==="ON":console.log("Unknown message",m)}}function h(t){l.value=[],i.value=t,v=e.subscribe(y(t,E.STAT)+"RESULT",(n,d)=>g(t,n,d)),["ZbStatus1","SetOption83","SetOption89","SetOption112","SensorRetain"].forEach(n=>{e.publish(y(t,E.CMND)+n,"")})}function f(t,n){const d=i.value;d&&(typeof n=="boolean"&&(n=Number(n)),e.publish(y(d,E.CMND)+t,`${n}`),h(d))}function b(t){return t.md==="Sonoff ZbBridge"||t.md==="Sonoff Zigbee Pro"}function y(t,n=E.TELE){return t.ft.replace("%topic%",t.t).replace("%prefix%",t.tp[n])}const x=W(()=>Object.values(a.value).filter(t=>b(t)));function r(t){const n=t.IEEEAddr.toLowerCase(),d=t.ModelId==="TH01"?"SNZB-02":t.ModelId||"Unknown";return{id:n,config:{identifiers:[`zigbee2tasmota_${n}`],manufacturer:"SONOFF",model:`Temperature And Humidity Sensor (${d})`,name:t.Name},entities:["temperature","humidity","battery","voltage","linkquality"].map(o=>c(t,o))}}function c(t,n){const d=t.IEEEAddr.toLowerCase(),m={type:"sensor",id:n},o={availability_mode:"all",availability_topic:`${y(i.value,E.TELE)}LWT`,payload_available:"Online",payload_not_available:"Offline",name:`${t.Name} `,state_topic:`${y(i.value,E.TELE)}${s.value.SetOption83?t.Name:t.Device}/SENSOR`,unique_id:`${d}_${n}_zigbee2tasmota`,state_class:"measurement"};let p;return n==="temperature"&&(p="Temperature",o.device_class="temperature",o.enabled_by_default=!0,o.unit_of_measurement="°C",o.name+=n),n==="humidity"&&(p="Humidity",o.device_class="humidity",o.enabled_by_default=!0,o.unit_of_measurement="%",o.name+=n),n==="battery"&&(p="BatteryPercentage",o.device_class="battery",o.enabled_by_default=!0,o.unit_of_measurement="%",o.entity_category="diagnostic",o.name+=n),n==="voltage"&&(p="BatteryVoltage",o.device_class="voltage",o.enabled_by_default=!1,o.unit_of_measurement="V",o.entity_category="diagnostic",o.name+=n),n==="linkquality"&&(p="LinkQuality",o.device_class="linkquality",o.enabled_by_default=!1,o.unit_of_measurement="lqi",o.icon="mdi:signal",o.entity_category="diagnostic",o.name+=n),o.value_template=`{% if value_json.ZbReceived.${s.value.SetOption112?t.Name:t.Device}.${p} is defined %}
  {{ value_json.ZbReceived.${s.value.SetOption112?t.Name:t.Device}.${p} }}
{% else %}
  {{ states(entity_id) }}
{% endif %}
`,m.config=o,m}function L(){l.value.filter(t=>["TH01","SNZB-02P","SNZB-02D"].includes(t.ModelId)).forEach(t=>{j.addDevice(r(t))}),this.router.push("/discovery-generator")}function Z(t){const n=t.IEEEAddr.toLowerCase(),d=t.ModelId||"TRVZB",m=s.value.SetOption112?t.Name:t.Device,o=s.value.SetOption83?t.Name:t.Device;return{id:n,config:{identifiers:[`zigbee2tasmota_${n}`],manufacturer:"SONOFF",model:`Zigbee Thermostatic Radiator Valve (${d})`,name:t.Name},entities:[A(t,m,o),H(t,"local_temperature",m,o),H(t,"heating",m,o),H(t,"linkquality",m,o)]}}function A(t,n,d){const m=t.IEEEAddr.toLowerCase(),o=`${y(i.value,E.TELE)}${d}/SENSOR`;return{type:"climate",id:"climate",config:{availability_mode:"all",availability_topic:`${y(i.value,E.TELE)}LWT`,payload_available:"Online",payload_not_available:"Offline",name:t.Name,unique_id:`${m}_climate_zigbee2tasmota`,modes:["off","heat"],current_temperature_topic:o,current_temperature_template:`{% if value_json.ZbReceived.${n}.LocalTemperature is defined %}
  {{ value_json.ZbReceived.${n}.LocalTemperature }}
{% else %}
  {{ states.climate.${t.Name.replace(/[^a-zA-Z0-9_]/g,"_")}.attributes.current_temperature | default(0) }}
{% endif %}`,temperature_state_topic:o,temperature_state_template:`{% if value_json.ZbReceived.${n}.OccupiedHeatingSetpoint is defined %}
  {{ value_json.ZbReceived.${n}.OccupiedHeatingSetpoint }}
{% else %}
  {{ states.climate.${t.Name.replace(/[^a-zA-Z0-9_]/g,"_")}.attributes.temperature | default(20) }}
{% endif %}`,temperature_command_topic:`${y(i.value,E.CMND)}ZbSend`,temperature_command_template:`{"Device":"${t.Device}","Write":{"OccupiedHeatingSetpoint":{{ value }}}}`,mode_state_topic:o,mode_state_template:`{% if value_json.ZbReceived.${n}.Power is defined %}
  {{ 'heat' if value_json.ZbReceived.${n}.Power == 1 else 'off' }}
{% else %}
  {{ states('climate.${t.Name.replace(/[^a-zA-Z0-9_]/g,"_")}') | default('off') }}
{% endif %}`,mode_command_topic:`${y(i.value,E.CMND)}ZbSend`,mode_command_template:`{"Device":"${t.Device}","Write":{"Power":{{ '1' if value == 'heat' else '0' }}}}`,min_temp:4,max_temp:35,temp_step:.5,temperature_unit:"C"}}}function H(t,n,d,m){const o=t.IEEEAddr.toLowerCase(),p={type:"sensor",id:n},_={availability_mode:"all",availability_topic:`${y(i.value,E.TELE)}LWT`,payload_available:"Online",payload_not_available:"Offline",name:`${t.Name} `,state_topic:`${y(i.value,E.TELE)}${m}/SENSOR`,unique_id:`${o}_${n}_zigbee2tasmota`,state_class:"measurement"};let T;return n==="local_temperature"&&(T="LocalTemperature",_.device_class="temperature",_.enabled_by_default=!1,_.unit_of_measurement="°C",_.name+="temperature"),n==="heating"&&(T="Power",_.enabled_by_default=!1,_.icon="mdi:radiator",_.name+="heating",delete _.state_class),n==="linkquality"&&(T="LinkQuality",_.enabled_by_default=!1,_.unit_of_measurement="lqi",_.icon="mdi:signal",_.entity_category="diagnostic",_.name+="linkquality"),_.value_template=`{% if value_json.ZbReceived.${d}.${T} is defined %}
  {{ value_json.ZbReceived.${d}.${T} }}
{% else %}
  {{ states(entity_id) }}
{% endif %}
`,p.config=_,p}function S(){l.value.filter(t=>t.ModelId==="TRVZB").forEach(t=>{j.addDevice(Z(t))}),this.router.push("/discovery-generator")}return{config:s,ZbInfos:l,devices:a,devicesCount:W(()=>Object.keys(a.value).length),zbBridges:x,selectedZBDevice:i,getZbInfo:h,publishCmd:f,isZBBridge:b,resolveFullTopic:y,generateHomeAssistantDiscoveryForAllSNZB02:L,generateHomeAssistantDiscoveryForAllTRVZB:S}});function oe(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),U.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const se={target:{type:[Boolean,String,Element],default:!0},noParentEvent:Boolean},he={...se,contextMenu:Boolean};function pe({showing:e,avoidEmit:a,configureAnchorEl:l}){const{props:i,proxy:s,emit:v}=J(),u=w(null);let g=null;function h(r){return u.value===null?!1:r===void 0||r.touches===void 0||r.touches.length<=1}const f={};l===void 0&&(Object.assign(f,{hide(r){s.hide(r)},toggle(r){s.toggle(r),r.qAnchorHandled=!0},toggleKey(r){X(r,13)===!0&&f.toggle(r)},contextClick(r){s.hide(r),k(r),K(()=>{s.show(r),r.qAnchorHandled=!0})},prevent:k,mobileTouch(r){if(f.mobileCleanup(r),h(r)!==!0)return;s.hide(r),u.value.classList.add("non-selectable");const c=r.target;B(f,"anchor",[[c,"touchmove","mobileCleanup","passive"],[c,"touchend","mobileCleanup","passive"],[c,"touchcancel","mobileCleanup","passive"],[u.value,"contextmenu","prevent","notPassive"]]),g=setTimeout(()=>{g=null,s.show(r),r.qAnchorHandled=!0},300)},mobileCleanup(r){u.value.classList.remove("non-selectable"),g!==null&&(clearTimeout(g),g=null),e.value===!0&&r!==void 0&&oe()}}),l=function(r=i.contextMenu){if(i.noParentEvent===!0||u.value===null)return;let c;r===!0?s.$q.platform.is.mobile===!0?c=[[u.value,"touchstart","mobileTouch","passive"]]:c=[[u.value,"mousedown","hide","passive"],[u.value,"contextmenu","contextClick","notPassive"]]:c=[[u.value,"click","toggle","passive"],[u.value,"keyup","toggleKey","passive"]],B(f,"anchor",c)});function b(){G(f,"anchor")}function y(r){for(u.value=r;u.value.classList.contains("q-anchor--skip");)u.value=u.value.parentNode;l()}function x(){if(i.target===!1||i.target===""||s.$el.parentNode===null)u.value=null;else if(i.target===!0)y(s.$el.parentNode);else{let r=i.target;if(typeof i.target=="string")try{r=document.querySelector(i.target)}catch{r=void 0}r!=null?(u.value=r.$el||r,l()):(u.value=null,console.error(`Anchor: target "${i.target}" not found`))}}return N(()=>i.contextMenu,r=>{u.value!==null&&(b(),l(r))}),N(()=>i.target,()=>{u.value!==null&&b(),x()}),N(()=>i.noParentEvent,r=>{u.value!==null&&(r===!0?b():l())}),Y(()=>{x(),a!==!0&&i.modelValue===!0&&u.value===null&&v("update:modelValue",!1)}),I(()=>{g!==null&&clearTimeout(g),b()}),{anchorEl:u,canShow:h,anchorEvents:f}}function ge(e,a){const l=w(null);let i;function s(g,h){const f=`${h!==void 0?"add":"remove"}EventListener`,b=h!==void 0?h:i;g!==window&&g[f]("scroll",b,R.passive),window[f]("scroll",b,R.passive),i=h}function v(){l.value!==null&&(s(l.value),l.value=null)}const u=N(()=>e.noParentEvent,()=>{l.value!==null&&(v(),a())});return I(u),{localScrollTarget:l,unconfigureScrollTarget:v,changeScrollEvent:s}}const{notPassiveCapture:C}=R,$=[];function D(e){const a=e.target;if(a===void 0||a.nodeType===8||a.classList.contains("no-pointer-events")===!0)return;let l=z.length-1;for(;l>=0;){const i=z[l].$;if(i.type.name==="QTooltip"){l--;continue}if(i.type.name!=="QDialog")break;if(i.props.seamless!==!0)return;l--}for(let i=$.length-1;i>=0;i--){const s=$[i];if((s.anchorEl.value===null||s.anchorEl.value.contains(a)===!1)&&(a===document.body||s.innerRef.value!==null&&s.innerRef.value.contains(a)===!1))e.qClickOutside=!0,s.onClickOutside(e);else return}}function be(e){$.push(e),$.length===1&&(document.addEventListener("mousedown",D,C),document.addEventListener("touchstart",D,C))}function _e(e){const a=$.findIndex(l=>l===e);a!==-1&&($.splice(a,1),$.length===0&&(document.removeEventListener("mousedown",D,C),document.removeEventListener("touchstart",D,C)))}let q,P;function ye(e){const a=e.split(" ");return a.length!==2?!1:["top","center","bottom"].includes(a[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(a[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function Se(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const M={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{M[`${e}#ltr`]=e,M[`${e}#rtl`]=e});function Ee(e,a){const l=e.split(" ");return{vertical:l[0],horizontal:M[`${l[1]}#${a===!0?"rtl":"ltr"}`]}}function re(e,a){let{top:l,left:i,right:s,bottom:v,width:u,height:g}=e.getBoundingClientRect();return a!==void 0&&(l-=a[1],i-=a[0],v+=a[1],s+=a[0],u+=a[0],g+=a[1]),{top:l,bottom:v,height:g,left:i,right:s,width:u,middle:i+(s-i)/2,center:l+(v-l)/2}}function ue(e,a,l){let{top:i,left:s}=e.getBoundingClientRect();return i+=a.top,s+=a.left,l!==void 0&&(i+=l[1],s+=l[0]),{top:i,bottom:i+1,height:1,left:s,right:s+1,width:1,middle:s,center:i}}function ce(e,a){return{top:0,center:a/2,bottom:a,left:0,middle:e/2,right:e}}function V(e,a,l,i){return{top:e[l.vertical]-a[i.vertical],left:e[l.horizontal]-a[i.horizontal]}}function de(e,a=0){if(e.targetEl===null||e.anchorEl===null||a>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{de(e,a+1)},10);return}const{targetEl:l,offset:i,anchorEl:s,anchorOrigin:v,selfOrigin:u,absoluteOffset:g,fit:h,cover:f,maxHeight:b,maxWidth:y}=e;if(ee.is.ios===!0&&window.visualViewport!==void 0){const d=document.body.style,{offsetLeft:m,offsetTop:o}=window.visualViewport;m!==q&&(d.setProperty("--q-pe-left",m+"px"),q=m),o!==P&&(d.setProperty("--q-pe-top",o+"px"),P=o)}const{scrollLeft:x,scrollTop:r}=l,c=g===void 0?re(s,f===!0?[0,0]:i):ue(s,g,i);Object.assign(l.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:y,maxHeight:b,visibility:"visible"});const{offsetWidth:L,offsetHeight:Z}=l,{elWidth:A,elHeight:H}=h===!0||f===!0?{elWidth:Math.max(c.width,L),elHeight:f===!0?Math.max(c.height,Z):Z}:{elWidth:L,elHeight:Z};let S={maxWidth:y,maxHeight:b};(h===!0||f===!0)&&(S.minWidth=c.width+"px",f===!0&&(S.minHeight=c.height+"px")),Object.assign(l.style,S);const t=ce(A,H);let n=V(c,t,v,u);if(g===void 0||i===void 0)O(n,c,t,v,u);else{const{top:d,left:m}=n;O(n,c,t,v,u);let o=!1;if(n.top!==d){o=!0;const p=2*i[1];c.center=c.top-=p,c.bottom-=p+2}if(n.left!==m){o=!0;const p=2*i[0];c.middle=c.left-=p,c.right-=p+2}o===!0&&(n=V(c,t,v,u),O(n,c,t,v,u))}S={top:n.top+"px",left:n.left+"px"},n.maxHeight!==void 0&&(S.maxHeight=n.maxHeight+"px",c.height>n.maxHeight&&(S.minHeight=S.maxHeight)),n.maxWidth!==void 0&&(S.maxWidth=n.maxWidth+"px",c.width>n.maxWidth&&(S.minWidth=S.maxWidth)),Object.assign(l.style,S),l.scrollTop!==r&&(l.scrollTop=r),l.scrollLeft!==x&&(l.scrollLeft=x)}function O(e,a,l,i,s){const v=l.bottom,u=l.right,g=te(),h=window.innerHeight-g,f=document.body.clientWidth;if(e.top<0||e.top+v>h)if(s.vertical==="center")e.top=a[i.vertical]>h/2?Math.max(0,h-v):0,e.maxHeight=Math.min(v,h);else if(a[i.vertical]>h/2){const b=Math.min(h,i.vertical==="center"?a.center:i.vertical===s.vertical?a.bottom:a.top);e.maxHeight=Math.min(v,b),e.top=Math.max(0,b-v)}else e.top=Math.max(0,i.vertical==="center"?a.center:i.vertical===s.vertical?a.top:a.bottom),e.maxHeight=Math.min(v,h-e.top);if(e.left<0||e.left+u>f)if(e.maxWidth=Math.min(u,f),s.horizontal==="middle")e.left=a[i.horizontal]>f/2?Math.max(0,f-u):0;else if(a[i.horizontal]>f/2){const b=Math.min(f,i.horizontal==="middle"?a.middle:i.horizontal===s.horizontal?a.right:a.left);e.maxWidth=Math.min(u,b),e.left=Math.max(0,b-e.maxWidth)}else e.left=Math.max(0,i.horizontal==="middle"?a.middle:i.horizontal===s.horizontal?a.left:a.right),e.maxWidth=Math.min(u,f-e.left)}export{ye as a,ge as b,pe as c,be as d,_e as e,oe as f,ve as g,he as h,Ee as p,ne as r,de as s,se as u,Se as v};
