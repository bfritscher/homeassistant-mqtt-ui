import{an as j,r as H,a as O,b2 as P,g as F,aj as k,W as Z,aa as V,j as Q,p as L,d as U,o as I,V as J,D as $,b3 as B,ag as K,J as X}from"./index-D_CVaFsZ.js";import{a as Y,u as G}from"./homeassistant-BxADD2ah.js";let ee=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const t=document.createElement("div");Object.assign(t.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(t),e.scrollLeft=-1e3,ee=e.scrollLeft>=0,e.remove()}const te=Y(),ne=new RegExp("tasmota/discovery/.*/config"),T={CMND:0,STAT:1,TELE:2},de=j("tasmota",()=>{const e=G(),t=H({}),i=H([]),n=H(null),o=H({SetOption83:null,SetOption89:null,SetOption112:null,SensorRetain:null});e.subscribe(ne,(r,u)=>{const b=JSON.parse(u);t.value[b.mac]=b,p(b)&&v(b)});let m,a=0;function g(r,u,b){const h=JSON.parse(b);if(h.ZbStatus1)i.value=h.ZbStatus1,a=0,i.value.forEach(s=>e.publish(S(r,T.CMND)+"ZbStatus3",s.Device));else if(h.ZbStatus3){const s=i.value.findIndex(x=>x.Device===h.ZbStatus3[0].Device),d=h.ZbStatus3[0];if(d.Name)i.value[s]=d;else{const{Device:x,..._}=d,y={Device:x,Name:"",..._};i.value[s]=y}a++,a===i.value.length&&m&&e.unsubscribe(m)}else{const s=Object.keys(h).pop();["SetOption83","SetOption89","SetOption112","SensorRetain"].includes(s)?o.value[s]=h[s]==="ON":console.log("Unknown message",h)}}function v(r){i.value=[],n.value=r,m=e.subscribe(S(r,T.STAT)+"RESULT",(u,b)=>g(r,u,b)),["ZbStatus1","SetOption83","SetOption89","SetOption112","SensorRetain"].forEach(u=>{e.publish(S(r,T.CMND)+u,"")})}function f(r,u){const b=n.value;b&&(typeof u=="boolean"&&(u=Number(u)),e.publish(S(b,T.CMND)+r,`${u}`),v(b))}function p(r){return r.md==="Sonoff ZbBridge"||r.md==="Sonoff Zigbee Pro"}function S(r,u=T.TELE){return r.ft.replace("%topic%",r.t).replace("%prefix%",r.tp[u])}const E=O(()=>Object.values(t.value).filter(r=>p(r)));function l(r){const u=r.IEEEAddr.toLowerCase(),b=r.ModelId==="TH01"?"SNZB-02":r.ModelId||"Unknown";return{id:u,config:{identifiers:[`zigbee2tasmota_${u}`],manufacturer:"SONOFF",model:`Temperature And Humidity Sensor (${b})`,name:r.Name},entities:["temperature","humidity","battery","voltage","linkquality"].map(s=>c(r,s))}}function c(r,u){const b=r.IEEEAddr.toLowerCase(),h={type:"sensor",id:u},s={availability_mode:"all",availability_topic:`${S(n.value,T.TELE)}LWT`,payload_available:"Online",payload_not_available:"Offline",name:`${r.Name} `,state_topic:`${S(n.value,T.TELE)}${o.value.SetOption83?r.Name:r.Device}/SENSOR`,unique_id:`${b}_${u}_zigbee2tasmota`,state_class:"measurement"};let d;return u==="temperature"&&(d="Temperature",s.device_class="temperature",s.enabled_by_default=!0,s.unit_of_measurement="Â°C",s.name+=u),u==="humidity"&&(d="Humidity",s.device_class="humidity",s.enabled_by_default=!0,s.unit_of_measurement="%",s.name+=u),u==="battery"&&(d="BatteryPercentage",s.device_class="battery",s.enabled_by_default=!0,s.unit_of_measurement="%",s.entity_category="diagnostic",s.name+=u),u==="voltage"&&(d="BatteryVoltage",s.device_class="voltage",s.enabled_by_default=!1,s.unit_of_measurement="V",s.entity_category="diagnostic",s.name+=u),u==="linkquality"&&(d="LinkQuality",s.device_class="linkquality",s.enabled_by_default=!1,s.unit_of_measurement="lqi",s.icon="mdi:signal",s.entity_category="diagnostic",s.name+=u),s.value_template=`{% if value_json.ZbReceived.${o.value.SetOption112?r.Name:r.Device}.${d} is defined %}
  {{ value_json.ZbReceived.${o.value.SetOption112?r.Name:r.Device}.${d} }}
{% else %}
  {{ states(entity_id) }}
{% endif %}
`,h.config=s,h}function M(){i.value.filter(r=>["TH01","SNZB-02P","SNZB-02D"].includes(r.ModelId)).forEach(r=>{te.addDevice(l(r))}),this.router.push("/discovery-generator")}return{config:o,ZbInfos:i,devices:t,devicesCount:O(()=>Object.keys(t.value).length),zbBridges:E,selectedZBDevice:n,getZbInfo:v,publishCmd:f,isZBBridge:p,resolveFullTopic:S,generateHomeAssistantDiscoveryForAllSNZB02:M}});function ie(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),P.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const le={target:{type:[Boolean,String,Element],default:!0},noParentEvent:Boolean},fe={...le,contextMenu:Boolean};function me({showing:e,avoidEmit:t,configureAnchorEl:i}){const{props:n,proxy:o,emit:m}=F(),a=H(null);let g=null;function v(l){return a.value===null?!1:l===void 0||l.touches===void 0||l.touches.length<=1}const f={};i===void 0&&(Object.assign(f,{hide(l){o.hide(l)},toggle(l){o.toggle(l),l.qAnchorHandled=!0},toggleKey(l){Q(l,13)===!0&&f.toggle(l)},contextClick(l){o.hide(l),k(l),V(()=>{o.show(l),l.qAnchorHandled=!0})},prevent:k,mobileTouch(l){if(f.mobileCleanup(l),v(l)!==!0)return;o.hide(l),a.value.classList.add("non-selectable");const c=l.target;Z(f,"anchor",[[c,"touchmove","mobileCleanup","passive"],[c,"touchend","mobileCleanup","passive"],[c,"touchcancel","mobileCleanup","passive"],[a.value,"contextmenu","prevent","notPassive"]]),g=setTimeout(()=>{g=null,o.show(l),l.qAnchorHandled=!0},300)},mobileCleanup(l){a.value.classList.remove("non-selectable"),g!==null&&(clearTimeout(g),g=null),e.value===!0&&l!==void 0&&ie()}}),i=function(l=n.contextMenu){if(n.noParentEvent===!0||a.value===null)return;let c;l===!0?o.$q.platform.is.mobile===!0?c=[[a.value,"touchstart","mobileTouch","passive"]]:c=[[a.value,"mousedown","hide","passive"],[a.value,"contextmenu","contextClick","notPassive"]]:c=[[a.value,"click","toggle","passive"],[a.value,"keyup","toggleKey","passive"]],Z(f,"anchor",c)});function p(){J(f,"anchor")}function S(l){for(a.value=l;a.value.classList.contains("q-anchor--skip");)a.value=a.value.parentNode;i()}function E(){if(n.target===!1||n.target===""||o.$el.parentNode===null)a.value=null;else if(n.target===!0)S(o.$el.parentNode);else{let l=n.target;if(typeof n.target=="string")try{l=document.querySelector(n.target)}catch{l=void 0}l!=null?(a.value=l.$el||l,i()):(a.value=null,console.error(`Anchor: target "${n.target}" not found`))}}return L(()=>n.contextMenu,l=>{a.value!==null&&(p(),i(l))}),L(()=>n.target,()=>{a.value!==null&&p(),E()}),L(()=>n.noParentEvent,l=>{a.value!==null&&(l===!0?p():i())}),U(()=>{E(),t!==!0&&n.modelValue===!0&&a.value===null&&m("update:modelValue",!1)}),I(()=>{g!==null&&clearTimeout(g),p()}),{anchorEl:a,canShow:v,anchorEvents:f}}function he(e,t){const i=H(null);let n;function o(g,v){const f=`${v!==void 0?"add":"remove"}EventListener`,p=v!==void 0?v:n;g!==window&&g[f]("scroll",p,$.passive),window[f]("scroll",p,$.passive),n=v}function m(){i.value!==null&&(o(i.value),i.value=null)}const a=L(()=>e.noParentEvent,()=>{i.value!==null&&(m(),t())});return I(a),{localScrollTarget:i,unconfigureScrollTarget:m,changeScrollEvent:o}}const{notPassiveCapture:A}=$,w=[];function W(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let i=B.length-1;for(;i>=0;){const n=B[i].$;if(n.type.name==="QTooltip"){i--;continue}if(n.type.name!=="QDialog")break;if(n.props.seamless!==!0)return;i--}for(let n=w.length-1;n>=0;n--){const o=w[n];if((o.anchorEl.value===null||o.anchorEl.value.contains(t)===!1)&&(t===document.body||o.innerRef.value!==null&&o.innerRef.value.contains(t)===!1))e.qClickOutside=!0,o.onClickOutside(e);else return}}function ve(e){w.push(e),w.length===1&&(document.addEventListener("mousedown",W,A),document.addEventListener("touchstart",W,A))}function ge(e){const t=w.findIndex(i=>i===e);t!==-1&&(w.splice(t,1),w.length===0&&(document.removeEventListener("mousedown",W,A),document.removeEventListener("touchstart",W,A)))}let R,z;function pe(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function be(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const D={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{D[`${e}#ltr`]=e,D[`${e}#rtl`]=e});function Se(e,t){const i=e.split(" ");return{vertical:i[0],horizontal:D[`${i[1]}#${t===!0?"rtl":"ltr"}`]}}function oe(e,t){let{top:i,left:n,right:o,bottom:m,width:a,height:g}=e.getBoundingClientRect();return t!==void 0&&(i-=t[1],n-=t[0],m+=t[1],o+=t[0],a+=t[0],g+=t[1]),{top:i,bottom:m,height:g,left:n,right:o,width:a,middle:n+(o-n)/2,center:i+(m-i)/2}}function ae(e,t,i){let{top:n,left:o}=e.getBoundingClientRect();return n+=t.top,o+=t.left,i!==void 0&&(n+=i[1],o+=i[0]),{top:n,bottom:n+1,height:1,left:o,right:o+1,width:1,middle:o,center:n}}function se(e,t){return{top:0,center:t/2,bottom:t,left:0,middle:e/2,right:e}}function q(e,t,i,n){return{top:e[i.vertical]-t[n.vertical],left:e[i.horizontal]-t[n.horizontal]}}function re(e,t=0){if(e.targetEl===null||e.anchorEl===null||t>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{re(e,t+1)},10);return}const{targetEl:i,offset:n,anchorEl:o,anchorOrigin:m,selfOrigin:a,absoluteOffset:g,fit:v,cover:f,maxHeight:p,maxWidth:S}=e;if(K.is.ios===!0&&window.visualViewport!==void 0){const x=document.body.style,{offsetLeft:_,offsetTop:y}=window.visualViewport;_!==R&&(x.setProperty("--q-pe-left",_+"px"),R=_),y!==z&&(x.setProperty("--q-pe-top",y+"px"),z=y)}const{scrollLeft:E,scrollTop:l}=i,c=g===void 0?oe(o,f===!0?[0,0]:n):ae(o,g,n);Object.assign(i.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:S,maxHeight:p,visibility:"visible"});const{offsetWidth:M,offsetHeight:r}=i,{elWidth:u,elHeight:b}=v===!0||f===!0?{elWidth:Math.max(c.width,M),elHeight:f===!0?Math.max(c.height,r):r}:{elWidth:M,elHeight:r};let h={maxWidth:S,maxHeight:p};(v===!0||f===!0)&&(h.minWidth=c.width+"px",f===!0&&(h.minHeight=c.height+"px")),Object.assign(i.style,h);const s=se(u,b);let d=q(c,s,m,a);if(g===void 0||n===void 0)N(d,c,s,m,a);else{const{top:x,left:_}=d;N(d,c,s,m,a);let y=!1;if(d.top!==x){y=!0;const C=2*n[1];c.center=c.top-=C,c.bottom-=C+2}if(d.left!==_){y=!0;const C=2*n[0];c.middle=c.left-=C,c.right-=C+2}y===!0&&(d=q(c,s,m,a),N(d,c,s,m,a))}h={top:d.top+"px",left:d.left+"px"},d.maxHeight!==void 0&&(h.maxHeight=d.maxHeight+"px",c.height>d.maxHeight&&(h.minHeight=h.maxHeight)),d.maxWidth!==void 0&&(h.maxWidth=d.maxWidth+"px",c.width>d.maxWidth&&(h.minWidth=h.maxWidth)),Object.assign(i.style,h),i.scrollTop!==l&&(i.scrollTop=l),i.scrollLeft!==E&&(i.scrollLeft=E)}function N(e,t,i,n,o){const m=i.bottom,a=i.right,g=X(),v=window.innerHeight-g,f=document.body.clientWidth;if(e.top<0||e.top+m>v)if(o.vertical==="center")e.top=t[n.vertical]>v/2?Math.max(0,v-m):0,e.maxHeight=Math.min(m,v);else if(t[n.vertical]>v/2){const p=Math.min(v,n.vertical==="center"?t.center:n.vertical===o.vertical?t.bottom:t.top);e.maxHeight=Math.min(m,p),e.top=Math.max(0,p-m)}else e.top=Math.max(0,n.vertical==="center"?t.center:n.vertical===o.vertical?t.top:t.bottom),e.maxHeight=Math.min(m,v-e.top);if(e.left<0||e.left+a>f)if(e.maxWidth=Math.min(a,f),o.horizontal==="middle")e.left=t[n.horizontal]>f/2?Math.max(0,f-a):0;else if(t[n.horizontal]>f/2){const p=Math.min(f,n.horizontal==="middle"?t.middle:n.horizontal===o.horizontal?t.right:t.left);e.maxWidth=Math.min(a,p),e.left=Math.max(0,p-e.maxWidth)}else e.left=Math.max(0,n.horizontal==="middle"?t.middle:n.horizontal===o.horizontal?t.left:t.right),e.maxWidth=Math.min(a,f-e.left)}export{pe as a,he as b,me as c,ve as d,ge as e,ie as f,de as g,fe as h,Se as p,ee as r,re as s,le as u,be as v};
